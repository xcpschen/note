- nginx的内部结构是由核心部分(nginx core)和一系列的功能模块所组成。
- nginx提供了web服务器的基础功能，同时提供了web服务反向代理，email服务反向代理功能。
- nginx core实现了底层的通讯协议，为其他模块和nginx进程构建了基本的运行时环境，并且构建了其他各模块的协作基础。

### 模块概述
nginx将各功能模块组织成一条链，当有请求到达的时候，请求依次经过这条链上的部分或者全部模块，进行处理。每个模块实现特定的功能

#### 2个特殊模块
http模块和mail模块，位于nginx core和各个功能模块中间。两模块在nginx core之上实现里另外一层抽象，处理与HTTP协议和email相关协议（SMTP/POP3/IMAP）有关的事件，并且确保这些事件能被以正确的顺序调用其他的一些功能模块。

目前HTTP协议是被实现在http模块中的，但是有可能将来被剥离到一个单独的模块中，以扩展nginx支持SPDY协议。

#### nginx的模块根据其功能分为以下类型

- event 搭建了独立于操作系统的事件处理机制的框架，及提供了各具体事件的处理.nginx具体使用何种事件
    - ngx_events_module
    - ngx_events_core_module
    - ngx_epoll_module
- module 处理模块，这依赖于具体的操作系统和编译选项
- phase 此类模块也被称为handler。主要负责处理客户端请求并产生待响应的内容
    - ngx_http_static_module 模块负责客户端静态页面请求处理并将对应的磁盘文件准备
- handler 是接受来自客户端的请求并产生响应输出的模块。
- output 也称为filter模块，主要负责对输出的内容进行处理，也可以对输出内容修改
- filter 过滤响应头和内容的模块，可以对回复的头和内容进行处理
- upstream 实现方向代理功能模块
- load-balancer 负载均衡模块

#### 工作原理
- 模块是Nginx主要处理请求的的劳动工作者。
- 当它接到一个HTTP请求时，它仅仅是通过查找配置文件将此次请求映射到一个location block，而此location中所配置的各个指令则会启动不同的模块去完成工作。
- 常一个location中的指令会涉及一个handler模块和多个filter模块
- 多个location可以复用同一个模块
- handler模块负责处理请求，完成响应内容的生成，而filter模块对响应内容进行处理

![659f05f7f5611e68a75f7a4d473043bb.png](evernotecid://2B0A12FB-E62F-416E-8574-4CB5888E1A40/appyinxiangcom/20623507/ENResource/p43)

### 模块的开发
可以开发的模块分为handler,filter,load-balancer

- handler 是接受来自客户端的请求并产生输出的模块。
- filter 是过滤响应头和内容的模块，可以对回复的头和内容进行处理
- load-balancer

### 参考
- [Nginx模块开发](https://www.cnblogs.com/softidea/p/4090653.html)

