# 术语
- TCP/IP协议模型:4层，应用层，传输层，网络层，网络接口层
- OSI模型：7层，应用层，表示层，会话层，传输层，网络层，数据链路层，物理层
- 网路层
  - IP协议：解决跨越不同类型物理网络的分组交换提供互操作；TCP，UDP，IMCP，IGMP的数据都以IP数据格式传输；不可靠
    - IP地址：网络地址，可分配
    - TTL：数据包在穿过多少个路由之后才会被抛弃，每进过一个路由则减1，8位
- ARP协议：根据IP地址获取MAC地址的协议；发送数据包时使用
- RARP协议：与ARP相反，根据MAC地址获取IP地址协议，接受数据包时使用
- ICMP协议：网络控制报文协议，但IP数据包发生错误时，如不可到达等，该协议会把错误信息封包传送回主机
- Ping：ICMP的应用
- Traceroute：用来侦测主机与目的主机之间的路由情况
- TCP协议：传输控制协议，面向字节流，可靠协议；全双工；具有拥塞控制，流量控制特性
  - 三次握手：建立TCP连接，确定序列号
  - TCP连接过程中的序号
    - 序列号seq：或确认应答号，按顺序给发送数据的每一个字节（8位字节）都标上号码的编号，字节与字节之间的分隔；接收端查询接收数据；TCP首部中的序列号和长度，将自己下一步应该接收的序号作为`确认应答返`送回去。
    - 确认ACK：在TCP中，当发送端的数据到达接收主机时，接收端主机会返回一个已收到消息的通知
    - 确认号ack：接收端，期待下一个接受的序列号，接受的`seq+1`
    - 同步SYN：用于建立连接，为1表示希望建立连接，在序列号的初始值；第一个发送的为客户端
    - 终止FIN：用于终止连接，为1时，表示不再发送数据；但是可能还有发送的数据还在途中
  - 半链接：Server发送SYN-ACK之后，收到Client的ACK之前的TCP连接状态
  - SYN攻击：典型DDOS攻击；TCP处于半链接状态，Client短时间内伪造大量不存在IP地址，向Server发送SYN,Server 回复确认，等待Client确认，由于IP地址不存在，导致超时重发，占用未连接队列，导致正常的SYN请求被丢弃，从而引起网络堵塞甚至系统瘫痪
    - 解决方案：删除这些连接，`netstat -nap | grep SYN_RECV`
  - 四次挥手：终止TCP连接，谁发起close谁进入time_wait
    - 等待2MSL：等待两倍报文段最大生存时间，保证TCP协议连接可靠关闭，保证当前连接重复数据报从网络消失
    - FIN_WAIT_1
    - FIN_WAIT_2
    - CLOSE_WAIT
    - LASK_WAIT
    - CLOSING
  - 流量控制：避免接收方来不及接收，导致数据丢失
    - 滑动窗口机制
    - 持续计时器：TCP为每一个连接设有一个持续计时器(persistence timer)。只要TCP连接的一方收到对方的零窗口通知，就启动持续计时器；若持续计时器设置的时间到期，就发送一个零窗口控测报文段（携1字节的数据），那么收到这个报文段的一方就重新设置持续计时器。
  - 拥塞控制：解决网络拥堵问题
    - RTT：传输轮次时间；往返时间
    - 策略
      - 拥塞窗口：cwnd,动态变化，大小取决与网络拥塞程度；发送方让自己的发送窗口等于拥塞窗口;
      - 慢开始算法：2的幂次方增长cwnd值
        - MSS：最大报文段数值
        - ssthresh状态：慢开始门限，用来避免cwnd增大引起网络拥塞，发送网络拥塞，则设置ssthresh为发送窗口的一半，cwnd=1执行慢开始算法
          - cwnd < ssthresh时 开始慢开始算法。
          - cwnd > ssthresh时，停止使用慢开始算法而改用拥塞避免算法。
          - cwnd = ssthresh时，既可使用慢开始算法，也可使用拥塞控制避免算法。
      - 拥塞避免：一个往返时间RTT 就把发送方的 拥塞窗口cwnd加1
      - 快重传：接收方每收到一个失序的报文段后就立即发出重复确认；发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段
      - 快恢复：与快重传配合使用的还有快恢复算法：
        - 当发送方连续收到三个重复确认，把慢开始门限ssthresh减半
        - 把cwnd值设置为 慢开始门限ssthresh减半后的数值，然后开始拥塞避免算法
  - TCP头部
    - 16位标志
      - CWR：2位，拥塞窗口减，发送方降低它的发送速率
      - ECE：2位，发送方接受到了一个更早的拥塞通知
      - URG：2位，紧急指针字段有效
      - ACK：2位。确认号字段有效，建立连接后一直启用
      - PSH：2位，推送，接收方应尽快给应用程序传送这个数据，不缓存
      - SYN：2位，用于初始化连接同步序列号
      - FIN：2位，终止链接标志
      - RST：即 Reset，用来强制断开连接。
    - 可选项
      - 格式
        - 种类：1字节
        - 长度：1字节
        - 值
      - 常见可选项
        - TimeStamp：TCP时间戳
          - kind(1 字节) + length(1 字节) + info(8 个字节)
          - info 有两部分构成: timestamp和timestamp echo，各占 4 个字节。
          - 解决问题：
            - 计算往返时延 RTT(Round-Trip Time)
            - 防止序列号的回绕问题
        - MSS：指的是 TCP 允许的从对方接收的最大报文段。
        - SACK: 选择确认选项。
        - Window Scale：窗口缩放选项。
- UDP协议：用户数据报协议
- DNS: 域名系统；因特网上作为域名和IP地址相互映射的一个分布式数据库；